# 2.5.1 - Create Full Book Record

Note: Pseudocode and variable/function names are only for guidance. The only things that are a must 
are the inputs and outputs of the functions.

Note: Creation of notes will be a separate function.

Note: Pretty much every function returns the values as JSON, this is for consistency for API accessing
These functions will need to either use existing, reworked, or new functions to construct.
The following functions are needed:
- is_isbn_in_book_table(isbn) -> JSON
  - Return JSON Schema:
    ````JSON
    {"is_isbn_present": "False"}    
    ````
- create_tag(owned, favorite, completed, currently_reading, personal_or_academic) -> JSON
  - Return JSON Schema:
    ````JSON
    {"tag_id": "2"}    
    ````
- read_author_id(author_first_name, author_last_name) -> JSON
  - Return JSON Schema:
    ````JSON
    {"AuthorID": "23"}  
    ````
    or when AuthorID not present
     ````JSON
    {"AuthorID": ""}   
    ````
- create_book_author_table_record(isbn, author_id) -> status code (will be checked globally if error)


- create_author(author_first_name, author_last_name) -> JSON
  - Return JSON Schema:
    ````JSON
    {"AuthorID": "24"}    
    ````
- read_publisher_id(publisher_name) -> JSON
  - Return JSON Schema:
    ````JSON
    {"PublisherID": "4"}    
    ````
    or when PublisherID not present
    ````JSON
    {"PublisherID": ""}    
    ````
- create_publisher(publisher_name) -> JSON
  - Return JSON Schema:
    ````JSON
    {"PublisherID": "4"}    
    ````
- read_genre_id_from_genre_table(genre_name) -> JSON
  - Return JSON Schema:
    ````JSON
    {"GenreID" : "1"}    
    ````
- create_book_genre_table_record(isbn, genre_id) -> status code (will be checked globally if error)


- create_book(isbn, title, publish_date, publisher_id, summary, tag_id, 
              chapters, chapters_completed,cover_image_bytes) -> status code (will be checked globally if error)



### 2.5.1.1 - Create Full Book Record from JSON (subfunctions will plug into here)
Input JSON:
```JSON
{"ISBN": "user_provided_isbn",
 "title": "SomeBook",
 "publish_date": "2026",
 "summary": "asdfdasadfsdfsafds",
 "chapters": "23",
 "chapters_completed": "3",
 "cover_image_bytes": "",
 "Author_First_Name_1": "John",
 "Author_Last_Name_1": "Doe",
 "Author_First_Name_2": "Jane",
 "Author_Last_Name_3": "Doe",
 "Publisher_Name": "SomePublisher",
 "Owned": "yes",
 "Favorite": "yes",
 "Completed": "no",
 "Currently_Reading": "yes",
 "PersonalOrAcademic": "personal",
 "Genre_1": "fiction",
 "Genre_2": "fantasy",
 "Genre_3": "humor",
 "Genre_4": "drama"}
```

````
create_book_record(json):
    # Note: Gets all values from JSON
    # Note: all required values have been validate by mediator at this point
    # Note: all variables that use get() method have a default value of '', since they are optional for creation
    
    isbn = json['ISBN']
    
    # First make sure ISBN not present in Book Table
    is_isbn_present = is_isbn_in_book_table(isbn) -> JSON
    print(is_isbn_present) # Should return for example: {"is_isbn_present": "False"}
    TRY:
        IF is_isbn_present['is_isbn_present'] != False:
            return "Error: Book with ISBN present.", 400
    EXCEPT:
        raise ERROR "Status Code 500"
    
    title = json['title']
    author_first_name_1 = json['Author_First_Name_1']
    author_last_name_1 = json['Author_Last_Name_1']
    author_first_name_2 = json.get('Author_First_Name_2', '')
    author_last_name_2 = json.get('Author_Last_Name_2', '')
    publish_date = json['publish_date']
    publisher_name = json['Publisher_Name']
    summary = json.get('summary', '')
    chapters = json.get('chapters', '')
    chapters_completed = json.get('chapters_completed', '')
    owned = json['Owned']
    favorite = json['Favorite']
    completed = json['Completed']
    currently_reading = json['Currently_Reading']
    personal_or_academic = json['PersonalOrAcademic']
    genre_1 = json['Genre_1']
    genre_2 = json.get('Genre_2', '')
    genre_3 = json.get('Genre_3', '')
    genre_4 = json.get('Genre_4', '')
    cover_image_bytes = json.get('cover_image_bytes', '')             
        
    # Next create the new tag record and return the new tag_id
    tag_response = create_tag(owned, favorite, completed, currently_reading, personal_or_academic) -> JSON
    print(tag_response) # Should return for example: {"tag_id": "2"}
                  # Example tag_id 2
    TRY:
        IF tag_response.get(tag_id, 'no_tag') != 'no_tag' # For the possibility of a no_tag error
            tag_id = tag_response['tag_id']
        ELSE:
            raise ERROR "Error: TagID not present.", 400
    EXCEPT:
        raise ERROR "Status Code 500"
    
    # Next check if AuthorID is present based on Author Name in Author Table
    author_1_response = read_author_id(author_first_name_1, author_last_name_1) -> JSON
    print(author_1_response) # Should return for example: {"AuthorID": "23"} or {"AuthorID": ""} if not present
    
    # We do author_1 first since there is always atleast one author
    IF author_1_response['AuthorID'] != '':
        # Here we use existing author_id and add a new record to the BookAuthor bridging table
        author_id_1 = author_1_response["AuthorID"] # Doesn't need to be assigned but used for clarity here
        create_book_author_table_record(isbn, author_id_1) -> status code (will be checked globally if error)
    ELSE:
        # Otherwise we first create a new author_id
        author_id_1 = create_author(author_first_name_1, author_last_name_1) -> JSON
        print(author_id_1) # Should return for example: {"AuthorID": "24"}
        create_book_author_table_record(isbn, author_id_1) -> status code (will be checked globally if error)
        
    # Then we do author_2 if present
    IF author_first_name_2 != '':                    
        author_2_response = read_author_id(author_first_name_2, author_last_name_2) -> JSON
        print(author_2_response) # Should return for example: {"AuthorID": ""}
        
        IF author_2_response['AuthorID'] != '':
            # Here we use existing author_id and add a new record to the BookAuthor brigding table
            author_id_2 = author_2_response["AuthorID"] # Doesn't need to be assigned but used for clarity here
            create_book_author_table_record(isbn, author_id_2) -> status code (will be checked globally if error)
        ELSE:
            # Otherwise we first create a new author_id
            author_id_2 = create_author(author_first_name_2, author_last_name_2) -> JSON
            print(author_id_2) # Should return for example: {"AuthorID": "24"}
            create_book_author_table_record(isbn, author_id_2) -> status code (will be checked globally if error)
    
    # Next we read or create publisher_id from publisher_name
    publisher_response = read_publisher_id(publisher_name) -> JSON
    print(publisher_response) # Should return for example: {"PublisherID": "4"} or {"PublisherID": ""} if not present
    
    IF publisher_response['PublisherID'] != '':
        publisher_id = publisher_response['PublisherID']
    ELSE:
        publisher_id['PublisherID'] = create_publisher(publisher_name) -> JSON
        print(publisher_id) # Should return for example: {"PublisherID": "4"}
    
    # Next we get the genre_id from the Genre Table using the genres
    genre_id_1['GenreID'] = read_genre_id_from_genre_table(genre_1) -> JSON
    print(genre_id_1) # Should return for example: {"GenreID" : "1"}
    # Create the record for the BookGenre bridging table
    create_book_genre_table_record(isbn, genre_id_1) -> status code (will be checked globally if error)
    
    IF genre_2 != '':
        genre_id_2['GenreID'] = read_genre_id_from_genre_table(genre_2) -> JSON
        create_book_genre_table_record(isbn, genre_id_2) -> status code (will be checked globally if error)
    IF genre_3 != '':
        genre_id_3['GenreID'] = read_genre_id_from_genre_table(genre_3) -> JSON
        create_book_genre_table_record(isbn, genre_id_3) -> status code (will be checked globally if error)
    IF genre_4 != '':
        genre_id_4['GenreID'] = read_genre_id_from_genre_table(genre_4) -> JSON
        create_book_genre_table_record(isbn, genre_id_4) -> status code (will be checked globally if error)
         
    # Finally we create the Book Table Record
    create_book(isbn, title, publish_date, publisher_id, summary, tag_id, 
                chapters, chapters_completed,cover_image_bytes) -> status code (will be checked globally if error)
    
    return status code
````


























